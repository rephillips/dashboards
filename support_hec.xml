<form hideEdit="false" script="common_control.js" stylesheet="shared.css">
  <!-- Author: Rob Phillips, rphillips@splunk.com -->
  <label>support_hec</label>
  <search id="hostwide_memory">
    <query>| tstats 
    $hostwide_agg_function$(data.mem_used) as mem_used latest(data.mem) as capacity
 where index=_introspection host IN $host$  sourcetype=splunk_resource_usage by host _time $span$
</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="hostwide_load_avg">
    <query>| tstats 
    $hostwide_agg_function$(data.normalized_load_avg_1min) as normalized_load_avg_1min 
 
 where index=_introspection  host IN $host$ sourcetype=splunk_resource_usage by  host _time $span$
</query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <search id="iostats_await">
    <query>| tstats $hostwide_agg_function$(data.avg_total_ms) as avg_total_ms where component::iostats index=_introspection host IN $host$ sourcetype=splunk_resource_usage
    by host data.mount_point _time $span$
    </query>
    <earliest>$time.earliest$</earliest>
    <latest>$time.latest$</latest>
  </search>
  <fieldset submitButton="false" autoRun="true">
    <input type="dropdown" searchWhenChanged="true" token="dmc_group">
      <label>Group</label>
      <showClearButton>false</showClearButton>
      <search>
        <query>
          | `dmc_get_groups_containing_role(dmc_group_indexer)`
          | search search_group!="dmc_group_*"
        </query>
      </search>
      <fieldForLabel>label</fieldForLabel>
      <fieldForValue>search_group</fieldForValue>
      <choice value="dmc_group_indexer">All Indexers</choice>
      <default>dmc_group_indexer</default>
      <change>
        <unset token="form.host"></unset>
      </change>
    </input>
    <input type="multiselect" searchWhenChanged="true" token="host">
      <label>Instance</label>
      <search>
        <query>| inputlookup dmc_assets 
| mvcombine search_group 
| search search_group=$dmc_group$
| where (search_group == "dmc_group_indexer") | table host</query>
      </search>
      <delimiter>,</delimiter>
      <fieldForLabel>host</fieldForLabel>
      <fieldForValue>host</fieldForValue>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <choice value="*">All</choice>
    </input>
    <input type="time" searchWhenChanged="true" token="time">
      <label>Time Range:</label>
      <default>
        <earliest>-60m@m</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="span" searchWhenChanged="true">
      <label>span</label>
      <choice value="30s">30s</choice>
      <choice value="60s">1m</choice>
      <choice value="5m">5m</choice>
      <choice value="15m">15m</choice>
      <choice value="1h">1h</choice>
      <prefix>span=</prefix>
      <default>60s</default>
    </input>
    <input type="checkbox" token="checked_config" searchWhenChanged="true">
      <label></label>
      <choice value="yes">show config settings</choice>
      <delimiter> </delimiter>
      <change>
        <condition value="yes">
          <eval token="checked_result_value">"A"</eval>
        </condition>
        <condition>
          <eval token="checked_result_value">"B"</eval>
        </condition>
      </change>
    </input>
    <input type="checkbox" token="checked_resource_usage" searchWhenChanged="true">
      <label></label>
      <choice value="yes">show resource usage</choice>
      <delimiter> </delimiter>
      <change>
        <condition value="yes">
          <eval token="checked_result_value">"A"</eval>
        </condition>
        <condition>
          <eval token="checked_result_value">"B"</eval>
        </condition>
      </change>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
 
  <p/>
  <h1>
          <span style="color: #ED179F">Description:</span>
        </h1> 
  This dashboard offers a consolidated view of configurations and metrics which are of interest when troubleshooting HEC performance / ingestion issues. The goal is to provide insights into the Splunk HEC receiver group (HF or indexer) for identifying any bottlenecks in the platform.
  <p/>
  Install this view on the monitoring console instance inside the monitoring console app and make sure the hec receiver group instances are added to the monitoring console as distributed search peers with the server role of indexer. Custom group labels can be applied in the monitoring console setup to group the hec receivers if necessary.
 For assistance configuring the monitoring console: <a href="https://docs.splunk.com/Documentation/Splunk/latest/DMC/Configureindistributedmode" target="_blank">https://docs.splunk.com/Documentation/Splunk/latest/DMC/Configureindistributedmode</a>.
  <p/>
  <p/>

</html>
    </panel>
  </row>
  <row>
    <panel depends="$checked_config$">
      <table>
        <title>server info</title>
        <search>
          <query>| rest /services/server/sysinfo splunk_server_group=dmc_group_indexer splunk_server_group=$dmc_group$ | search splunk_server IN $host$ | join splunk_server [| rest /services/server/info splunk_server_group=dmc_group_indexer splunk_server_group=$dmc_group$ | search splunk_server IN $host$ ]   | table splunk_server version  numberOfCores, numberOfVirtualCores  physicalMemoryMB ulimits.open_files  transparent_hugepages.effective_state | sort +splunk_server</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$checked_config$">
      <table>
        <title>http input settings</title>
        <search>
          <query>| rest splunk_server_group=dmc_group_indexer splunk_server_group=$dmc_group$  /services/properties/inputs/http/disabled | search value=0 | search splunk_server IN $host$  | rename value as disabled
 | join splunk_server [ | rest /services/properties/inputs/http/dedicatedIoThreads | rename value as dedicatedIoThreads] | join splunk_server [ | rest /services/properties/inputs/http/enableSSL | rename value as enableSSL] | join splunk_server [ | rest /services/properties/inputs/http/port | rename value as port] | join splunk_server [ | rest /services/properties/inputs/http/maxSockets | rename value as maxSockets] | join splunk_server [ | rest /services/properties/inputs/http/maxThreads | rename value as maxThreads] | eval stanza="http" | eval conf="inputs.conf"|  fields splunk_server conf stanza maxSockets  maxThreads dedicatedIoThreads  enableSSL port disabled | sort +splunk_server</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$checked_config$">
      <input type="multiselect" token="stanza" searchWhenChanged="true">
        <label>hec input stanza</label>
        <choice value="*">All</choice>
        <default>*</default>
        <prefix>stanza=</prefix>
        <initialValue>*</initialValue>
        <delimiter> OR stanza= </delimiter>
        <fieldForLabel>stanza</fieldForLabel>
        <fieldForValue>stanza</fieldForValue>
        <search>
          <query>| rest splunk_server_group=dmc_group_indexer splunk_server_group=$dmc_group$ /services/data/inputs/http | search title!=*streamfwd | search disabled=0 | search splunk_server IN $host$ | fields  title  | rename title as stanza | dedup stanza</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <valuePrefix>"</valuePrefix>
        <valueSuffix>"</valueSuffix>
      </input>
      <table>
        <title>HEC input tokens</title>
        <search>
          <query>| rest splunk_server_group=dmc_group_indexer splunk_server_group=$dmc_group$ /services/data/inputs/http | search splunk_server IN $host$ | search title!=*streamfwd | eval conf="inputs.conf" | fields splunk_server conf title index indexes sourcetype token useACK disabled |eval useACK=if(isnull(useACK),0,useACK) | rename title as stanza | sort +splunk_server | search $stanza$</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$checked_config$">
      <table>
        <title>parallelIngestionPipelines</title>
        <search>
          <query>| rest splunk_server_group=dmc_group_indexer splunk_server_group=$dmc_group$  /services/properties/server/general/parallelIngestionPipelines | search splunk_server IN $host$ | rename value as "parallelIngestionPipelines" | eval conf="server.conf" | eval stanza="general" | table splunk_server conf stanza "parallelIngestionPipelines" | sort +splunk_server</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$checked_config$">
      <table>
        <title>input_channels</title>
        <search>
          <query>| rest splunk_server_group=dmc_group_indexer splunk_server_group=dmc_indexerclustergroup_lab-cluster01 /services/properties/limits/input_channels/max_inactive  | search splunk_server IN $host$  | rename value as "max_inactive" | eval conf="limits.conf" | eval stanza="input_channels" | join splunk_server [| rest splunk_server_group=dmc_group_indexer splunk_server_group=dmc_indexerclustergroup_lab-cluster01   /services/properties/limits/input_channels/lowater_inactive | search splunk_server IN $host$ | rename value as "lowater_inactive" | eval conf="limits.conf" | eval stanza="input_channels" ] | table splunk_server conf stanza "max_inactive" "lowater_inactive"  | sort +splunk_server</query>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">100</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel depends="$checked_resource_usage$">
      <input type="dropdown" token="hostwide_agg_function" searchWhenChanged="true">
        <label>aggregation function</label>
        <choice value="max">Max</choice>
        <choice value="avg">Avg</choice>
        <choice value="median">Median</choice>
        <choice value="p90">90 percentile</choice>
        <default>avg</default>
        <initialValue>avg</initialValue>
      </input>
      <html>
        <h1>
          <b>
            <span style="color: #ED179F">Maximum Physical Memory Usage Deployment-Wide</span>  </b>

        </h1>

        <b>Description:</b> Shows maximum physical memory usage percentage across members of the selected group.
</html>
      <html>
        <p>
          <b>Recommended Action:</b>Review Monitoring Console Resource Usage Instance views to determine the processes consuming the most memory.</p>
          </html>
      <html>
        <p>Click chart for per host detail.</p>

      </html>
      <chart>
        <search base="hostwide_memory">
          <query>| timechart $span$ max(mem_used) as "memory_used" min(capacity) as "capacity_min" max(capacity) as "capacity_max"</query>
        </search>
        <option name="charting.axisTitleY.text">memory used MB</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.overlayFields">capacity_min,capacity_max</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="m1">$click.value2$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$m1$">
      <chart>
        <title>$hostwide_agg_function$ Memory Usage MB - By Host</title>
        <search base="hostwide_memory">
          <query>| timechart $span$ max(mem_used) as "memory_used" latest(capacity) as "capacity" by host </query>
        </search>
        <option name="charting.axisTitleY.text">memory used MB</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html>
    <a data-unset-token="m1">Close this panel</a>
  </html>
    </panel>
  </row>
  <row>
    <panel depends="$checked_resource_usage$">
      <html>
        <h1>
          <b>
            <span style="color: #ED179F">Maximum Load Average Deployment-Wide</span>  </b>

        </h1>

        <b>Description:</b> Shows maximum normalized 1m load avg based on physical cpu core count across all members of the selected group.
</html>
      <html>
        <p>
          <b>Recommended Action:</b>Sustained values above 1 are concerning (1=100% cpu system utilization), review Monitoring Console Resource Usage Instance views to determine the processes consuming the most cpu.</p>
          </html>
      <html>
        <p>Click chart for per host detail.</p>

      </html>
      <chart>
        <search base="hostwide_load_avg">
          <query>| timechart $span$ max(normalized_load_avg_1min) as "normalized_load_avg_1min" | eval ceiling=1</query>
        </search>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.overlayFields">ceiling</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="c1">$click.value2$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$c1$">
      <chart>
        <title>$hostwide_agg_function$ Load Average - by host</title>
        <search base="hostwide_load_avg">
          <query>| timechart $span$ max(normalized_load_avg_1min) as "normalized_load_avg_1min" by host | eval ceiling=1</query>
        </search>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.overlayFields">ceiling</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html>
    <a data-unset-token="c1">Close this panel</a>
  </html>
    </panel>
  </row>
  <row>
    <panel depends="$checked_resource_usage$">
      <html>
        <h1>
          <b>
            <span style="color: #ED179F">Maximum Disk latency</span>  </b>

        </h1>

        <b>Description:</b> The average time (in milliseconds) for I/O requests issued to the device to be served. This includes the time spent by the requests in queue and the time spent servicing them.
</html>
      <html>
        <p>
          <b>Recommended Action:</b> Use to review Disk latency. Ideal await times for any mount point where Splunk operates is under 10ms</p>
          </html>
      <chart>
        <search base="iostats_await">
          <query>| timechart $span$ max(avg_total_ms) as "avg_total_ms" | eval ideal_latency_ms=10</query>
        </search>
        <option name="charting.axisTitleY.text">disk await (ms)</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">area</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.overlayFields">ideal_latency_ms</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="d1">$click.value2$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$d1$">
      <chart>
        <title>$hostwide_agg_function$ Disk Latency - by host</title>
        <search base="iostats_await">
          <query>| timechart $span$ max(avg_total_ms) as "avg_total_ms" by host  | eval ideal_latency_ms=10</query>
        </search>
        <option name="charting.axisTitleY.text">disk await (ms)</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.overlayFields">ideal_latency_ms</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="d2">$click.name2$</set>
        </drilldown>
      </chart>
      <html>
    <a data-unset-token="d1">Close this panel</a>
  </html>
    </panel>
  </row>
  <row>
    <panel depends="$d2$">
      <chart>
        <title>$hostwide_agg_function$ Disk Latency - by mount point</title>
        <search base="iostats_await">
          <query> | search host="$d2$" | timechart $span$ max(avg_total_ms) as "avg_total_ms" by data.mount_point  | eval ideal_latency_ms=10</query>
        </search>
        <option name="charting.axisTitleY.text">disk await (ms)</option>
        <option name="charting.axisY.minimumNumber">0</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.nullValueMode">connect</option>
        <option name="charting.chart.overlayFields">ideal_latency_ms</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.legend.placement">right</option>
        <option name="height">389</option>
        <option name="refresh.display">progressbar</option>
      </chart>
      <html>
    <a data-unset-token="d2">Close this panel</a>
  </html>
    </panel>
  </row>
  <row>
    <panel>
      <input type="multiselect" token="name" searchWhenChanged="true">
        <label>token name</label>
        <choice value="*">All</choice>
        <prefix>name=</prefix>
        <delimiter> OR name=</delimiter>
        <fieldForLabel>name</fieldForLabel>
        <fieldForValue>name</fieldForValue>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$  earliest=$time.earliest$ latest=$time.latest$ sourcetype=splunkd component=HttpInputDataHandler reply=* reply!=0

| stats count by name | fields name</query>
        </search>
        <change>
          <unset token="form.event_message"></unset>
        </change>
        <valuePrefix>"</valuePrefix>
        <valueSuffix>"</valueSuffix>
      </input>
      <input type="multiselect" token="event_message" searchWhenChanged="true">
        <label>event_message</label>
        <choice value="*">All</choice>
        <prefix>event_message=</prefix>
        <delimiter> OR event_message=</delimiter>
        <fieldForLabel>event_message</fieldForLabel>
        <fieldForValue>event_message</fieldForValue>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$ earliest=$time.earliest$ latest=$time.latest$ sourcetype=splunkd component=HttpInputDataHandler reply=* reply!=0 $name$

| stats count by reply | lookup HEC_reply_codes reply OUTPUT reply  event_message | fields event_message</query>
        </search>
        <valuePrefix>"</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <default>*</default>
      </input>
      <html>
        <h1>
          <b>
            <span style="color: #ED179F">HTTP Event Collector Errors</span>  </b>

        </h1>

        <b>Description:</b> Identifies if there are any HTTP Event Collector errors logged by the HEC reciever. These errors are logged under the HttpInputDataHandler component in splunkd.log
</html>
      <html>
        <p>
          <b>Recommended Action:</b> Review the reply code sent back to the client to determine the nature of the error. To ensure data is successfully ingested into the Splunk platform, configure your clients with the ability to act on response codes returned by the HEC endpoint. If the client can't take an action based on the resulting response code, data loss might occur.</p>
          <p>If no response to the client is logged (pre Splunk 8.x) enable DEBUG:</p>
          <p>./splunk set log-level HttpInputDataHandler -level DEBUG</p>
          <p>to revert logging level:</p>
          <p>./splunk set log-level HttpInputDataHandler -level WARN</p>
          </html>
      <table>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$  sourcetype=splunkd component=HttpInputDataHandler  $name$ reply!=0

| stats count by host name reply source_IP

| lookup HEC_reply_codes reply OUTPUT reply status HttpInputReply event_message | table host name source_IP reply HttpInputReply event_message status count | sort -count | search $event_message$</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <chart>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$  sourcetype=splunkd component=HttpInputDataHandler  $name$

| lookup HEC_reply_codes reply OUTPUT reply HttpInputReply event_message | search $event_message$ | eval host_name_reply=host."::".name."::".HttpInputReply | timechart $span$ minspan=30s count by host_name_reply</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">0</option>
        <option name="trellis.size">large</option>
        <option name="trellis.splitBy">_aggregation</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>
          <b>
            <span style="color: #ED179F">Blocked Queues</span>  </b>

        </h1>

        <b>Description:</b> Identifies if there are any blocked queues by host and queue name. Blocked queues can lead to backpressure to the hec clients and result in data loss.
</html>
      <html>
        <p>
          <b>Recommended Action:</b> Use the monitoring console Indexing&gt;Performance&gt;Instance to troubleshoot Splunk data processing queues.</p>
          </html>
      <chart>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$  sourcetype=splunkd TERM(group=queue) 
                       TERM(blocked=true)  | timechart $span$ minspan=30s count by host useother=f limit=0</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <set token="h1">$click.name2$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$h1$">
      <html>
    <a data-unset-token="h1">Close this panel</a>
  </html>
      <chart>
        <title>blocked queues for $h1$ by queue name</title>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$  host=$h1$  sourcetype=splunkd  TERM(group=queue) 
                       TERM(blocked=true)  | timechart span=60s minspan=30s count by name useother=f limit=0</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
       <h1>
         <b>
           <span style="color: #ED179F">Channels</span>  </b>

       </h1>

       <b>Description:</b> A channel is a virtual connection Splunk maintains which is a tuple of source+sourcetype+host. More than 
       <b>
           <span style="color: #ED179F">5k</span>  </b> 
           per ingest pipe or <b>
           <span style="color: #ED179F">10k</span>  </b>  total across all ingest pipes per Splunk instance can reduce ingestion thruput.
</html>
      <html>
       <p>
<b>Recommended Action:</b> <p>
         <b>a.)</b> Consider increasing parallel ingestion pipelines if more than 5k channels per ingest pipe but less than 10k per instance</p>
<p>server.conf:</p>
<p>[general]</p>
<p>parallelIngestionPipelines = 2</p>
<p>
         <b>b.)</b> Increase inactive channels if more than 10k new_channels per instance in a 30s span. By increasing inactive channels we are building a larger cache of inactive channels which can be reused. This can increase thruput as channels live longer. This action is only effective when those input channels could have been reused: for example, the source, sourcetype, and host fields are not generated randomly and tend to be reused within the lifetime of cached channel entries</p>

<p>limits.conf:</p>
<p>[input_channels]</p>
<p>max_inactive = 400000</p>
<p>lowater_inactive = 390000</p>
</p>



 
   </html>
      <chart>
        <title>new channel creation by host</title>
        <search>
          <query>| tstats
sum(PREFIX(new_channels=)) as new_channels
where
index=_internal  host IN $host$  sourcetype::splunkd
TERM(group=map) TERM(name=pipelineinputchannel)
by host _time span=30s
| timechart span=30s max(new_channels) by host limit=0 useother=f
| eval instance_channel_threshold=10000</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <drilldown>
          <set token="h2">$click.name2$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row>
    <panel depends="$h2$">
      <html>
    <a data-unset-token="h2">Close this panel</a>
  </html>
      <chart>
        <title>new channel creation by ingest_pipe on $h2$</title>
        <search>
          <query>index=_internal  host IN $host$  sourcetype::splunkd host=$h2$    sourcetype=splunkd new_channels
| eval ingest_pipeline= if(isnull(ingest_pipe),0,ingest_pipe)
| timechart span=30s max(new_channels) by ingest_pipeline limit=0 useother=f | eval pipeline_channel_threshold=5000</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">pipeline_channel_threshold</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
        <h1>
          <b>
            <span style="color: #ED179F">Throughput KB/s per Instance</span>  </b>

        </h1>

        <b>Description:</b> Measures total throughput in KB/s per HEC receiver instance.
</html>
      <html>
        <p>
          <b>Recommended Action:</b> If throughput is greater than 20MB/s per HEC receiving instance (Heavy Forwarder), consider scaling horizontally by adding more heavy forwarders. </p>
          </html>
      <chart>
        <search>
          <query>index=_internal search_group="dmc_group_indexer" search_group=$dmc_group$ host IN $host$  sourcetype=splunkd  TERM(name=thruput) | timechart span=1m partial=f per_second(kb) AS kbps by host 
| eval kbps=round(kbps,0) | eval ceiling=20000</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
          <sampleRatio>1</sampleRatio>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">line</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.overlayFields">ceiling</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <html>
       <h1>
         <b>
           <span style="color: #ED179F">Tuning Tips</span>  </b>

       </h1>

       <b>sample config tuning on Splunk HEC receiver:</b> 

<p>
<p>
            <b style="color: #ED179F"> inputs.conf:</b>
          </p>
<p>
            <b>[http]</b>
          </p>
<p>dedicatedIoThreads = 8</p>
<p>#4-8 but not more than # of cpu cores. Default 0  (uses single thread)</p>
<p>busyKeepAliveIdleTimeout = x </p>
<p>#increase x if load balancer is in front of hec receivers. Set busyKeepAliveIdleTimeout value higher than load balancer's idle timeout value</p>
<p>#since HEC receivers (HFs or indexers) typically sit behind a load balancer we want to make sure Splunk is not closing the connection from LB to Splunk HEC receiver (HF/Indexer).</p>
<p>#busyKeepAliveIdleTimeout is important  to look at especially if the load balancer is showing 5xx errors.</p>

<p> </p>
<p>
            <b>[http://name]</b>
          </p>
<p>queueSize = 10MB</p>

<p>
            <b style="color: #ED179F">limits.conf:</b>
          </p>
<p>
            <b>[input_channels]</b>
          </p>
<p>max_inactive = 400000</p>
<p>lowater_inactive = 390000</p>

<p>
          <b style="color: #ED179F">server.conf:</b>
          </p>
<p>
            <b>[general]</b>
          </p>
<p>parallelIngestionPipelines = 2</p>
</p>
<br/>
<p>
         <b style="color: #ED179F">curl example:</b>
        </p>
<p>
          <b>if HEC receiver is not using indexer acknowledgement (useACK = 0):</b>
        </p>
<p>curl -k -H "Authorization: Splunk b5823516-1d22-4a7f-b6b3-74adb44da5ee" https://your-hec-receiver:8088/services/collector/event -d '{"sourcetype": "mysourcetype", "event": "sample hec event no ACK!"}'</p>

<p>
          <b>if HEC receiver is using indexer acknowledgement (useACK = 1) you must supply a channel identifier:</b>
        </p>

<p>curl -k -H "Authorization: Splunk b5823516-1d22-4a7f-b6b3-74adb44da5ee" -H "X-Splunk-Request-Channel: FE0ECFAD-13D5-401B-847D-77833BD77131" https://your-hec-receiver:8088/services/collector/event -d '{"sourcetype": "mysourcetype", "event": "sample hec event with ACKS"}'</p>


<p>
          <b>send event to metrics index:</b>
        </p>

<p>curl -k https://lb:8088/services/collector -H "Authorization: Splunk 9da23829-c89b-4b32-b139-634fbe74a74d" -d '{"time":1612845344.000,"source":"curl","host":"host_cm","fields":{"car_make":"Eagle","car_model":"Vision","metric_name:car_year":"2013","car_color":"Green","metric_name:car_price":"2320","metric_name:car_odometer":"47882"}}'</p>


   </html>
      <html> 

<p>
         <b style="color: #ED179F">resources:</b> </p>
        <p>
          <a target="_blank" href="https://docs.splunk.com/Documentation/Splunk/latest/Data/TroubleshootHTTPEventCollector">troubleshooting hec</a>
        </p>

<p>
          <a target="_blank" href="https://github.com/rephillips/dashboards">dashboard repository</a>
        </p>

       

</html>
    </panel>
  </row>
</form>
